server {
  listen 443 ssl;
  server_name seosan-issue.shop;

  # ... (ssl 설정 등은 동일) ...

  # Docker의 내장 DNS 서버 주소(127.0.0.11)를 resolver로 지정합니다.
  # Nginx가 이 DNS를 통해 서비스 이름을 동적으로 조회하게 됩니다.
  resolver 127.0.0.11 valid=10s;

  location = / {
    # ...
  }

  location = /api/v1/ai-search {
    # proxy_pass에 직접 서비스 이름을 쓰는 대신, 변수를 사용해야 합니다.
    # 이렇게 해야 Nginx가 resolver를 통해 매번 IP를 다시 조회합니다.
    set $backend_host backend;
    proxy_pass http://$backend_host:8083;
    # ... (나머지 proxy_set_header 등은 동일) ...
  }

  location / {
    # 위와 동일하게 변수 사용
    set $backend_host backend;
    proxy_pass http://$backend_host:8083;
    # ... (나머지 proxy_set_header 등은 동일) ...
  }
}