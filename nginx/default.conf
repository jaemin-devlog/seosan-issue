server {
    listen 80;
    server_name seosan-issue.shop;

    location /.well-known/acme-challenge/ { root /var/www/certbot; }
    location / { return 301 https://$host$request_uri; }
}

server {
    listen 443 ssl;
    server_name seosan-issue.shop;

    ssl_certificate     /etc/letsencrypt/live/seosan-issue.shop/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/seosan-issue.shop/privkey.pem;

    # ★ 루트만 200 OK로 응답 (백엔드 안 태움)
    location = / {
        return 200 "ok\n";
        add_header Content-Type text/plain;
    }

    # (선택) 민감 숨김파일 차단 — /.env, /.git 등
    location ~ /\.(git|env|hg|svn) {
        return 404;
    }

    # 나머지는 백엔드로 프록시
    location / {
        proxy_pass http://backend:8083;
        proxy_http_version 1.1;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout  10s;
        proxy_send_timeout     310s;
        proxy_read_timeout     310s;
        send_timeout           310s;
    }
}
